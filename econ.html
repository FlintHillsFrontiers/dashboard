<!DOCTYPE html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">
        <link rel="icon" href="../../favicon.ico">
    
        <title>Flint Hills Dashboard</title>
    
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
            
            
        <link href="template.css" rel="stylesheet">
    
        <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
        
        <!-- Mapbox-->
        <script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.4/mapbox.js'></script>
        <link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.4/mapbox.css' rel='stylesheet' />
        
        <!-- d3.js-->
        <script src="http://d3js.org/d3.v3.min.js"></script>
	
	<!-- Table Top-->
	<script src='tabletop.js'></script>
	
    </head>

  <body>

    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Flint Hills Dashboard</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a href="index.html">Strategy Prioritization Results</a></li>
            <li class=active><a href="econ.html">Economy</a></li>
            
            
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>


    <div class="container">
        <div class="content">

            <h1>Economy Metrics</h1>
            <hr>
            <h4>Flint Hills Unemployment by County</h4>
              
            <div style="width: 960px; height: 800px;">
                <div id="tooltip" class="hidden">
                <p><strong><span id="name">100</span></strong></p>
                <p><span id="unemployed">100</span></p>
                <p><span id="rate">100</span></p>
                </div>
            </div>
                <div class="map" style="margin-top: -800px"></div>
                
                
            </div>
        <input type="range" id="yearRange" value="2007"  min="2007" max="2013" step="1" />
            <span id="range"></span>
          

    <script>
      var dataset;
      window.onload = function() { init() };

      var public_spreadsheet_url = 'https://docs.google.com/spreadsheet/pub?hl=en_US&hl=en_US&key=194fY194abaOe9gjopnutM0kBWpnss8-f-wod8YzrjCg&output=html';

  function init() {
    Tabletop.init( { key: public_spreadsheet_url,
                     callback: showInfo,
                     simpleSheet: true } )
  }

  function showInfo(dataset, tabletop) {
    
    console.log(dataset);
    
  
  
    
    //Width and height
    var w = 500;
    var h = 650;
    
    //Define Projection and Scale                    
    var projection = d3.geo.albersUsa()
        .scale([9000])
        .translate([w/2, h/3]);;
 
    //Define default path generator
    var path = d3.geo.path()
        .projection(projection);
        
  

    //Create SVG element
    var svg = d3.select(".map")
	.append("svg")
	.attr("width", w)
	.attr("height", h);
 
    //Set Color Scale
    var color = d3.scale.quantile()
        .range(['rgb(26,150,65)','rgb(166,217,106)','rgb(253,174,97)','rgb(215,25,28)'])
        .domain([0.03, .08]);					//Colors taken from colorbrewer.js, included in the D3 download
        
    var year = document.getElementById("yearRange").value;
    document.getElementById("range").innerHTML=year;

d3.json("flinthills.geojson", function(json) {

	//Bind data and create one path per GeoJSON feature
	svg.selectAll("path")
            .data(json.features)
            .enter()
            .append("path")
            .attr("d", path)
            .style("fill","#e7e7e7")
            .style("stroke","#ccc")
            .style("stroke-width","1");
            
        svg.selectAll("text")
            .data(json.features)
            .enter()
            .append("text")
            .text(function(d){
                return d.properties.NAME10;
            })
            .attr("text-anchor", "middle")
            .attr("x", function(d){
                return projection([d.properties.INTPTLON10, d.properties.INTPTLAT10])[0];
            })
	    .attr("y", function(d){
                return projection([d.properties.INTPTLON10, d.properties.INTPTLAT10])[1];
            })
            .style("fill","#000")
                .attr("text-anchor", "middle")
            .style("font-size","10px")
            .style("text-transform","uppercase");


d3.json("ks-counties.json", function(json) {

	//Bind data and create one path per GeoJSON feature
	svg.selectAll("path")
            .data(json.features)
            .enter()
            .append("path")
            .attr("d", path)
            .attr("style", "kscounty")
            .style("fill","none")
            .style("fill-opacity","0")
            .style("stroke","#ddd")
            .style("stroke-width","0.5");
        
  
      
    //Load in GeoJSON data
    
            

        d3.json("us-states.geojson", function(json) {

	//Bind data and create one path per GeoJSON feature
	svg.selectAll("path")
            .data(json.features)
            .enter()
            .append("path")
            .attr("d", path)
            .style("fill","none")
            .style("stroke","#999");
    });
    
    
    

            

            //Draw circles for each point
	    
            svg.selectAll("circle")
                .data(dataset)
                .enter()
                .append("circle")
                .attr("cx", function(d) {
                    return projection([d.lon, d.lat])[0];
                })
                .attr("cy", function(d) {
                    return projection([d.lon, d.lat])[1];
                })
                //Set the Radius
                .attr("r", function(d){
                    return Math.sqrt(parseInt(d['unemp'+year.toString()]) * 0.5);    
                })
                //Set the Fill Color
                .style("fill", function(d) {
                    var value = d['unemprate'+year.toString()];			   		
                    if(value) {
                        return color(value);
                    }
                    else {
			//If value is undefined…
			return "#333";
		    }
		})
                .style("opacity",".75")
                .on("mouseover", function(d) {

                    //Get this bar's x/y values, then augment for the tooltip
                    var xPosition = parseFloat(d3.select(this).attr("cx")) +30;
                    var yPosition = parseFloat(d3.select(this).attr("cy")) -15;
                    
                    //Update the tooltip position and value
                    d3.select("#tooltip")
                      .style("left", xPosition + "px")
                      .style("top", yPosition  + "px")
                      .select("#name")
                      .text(d.name + " County");
                      
                    d3.select("#unemployed")
                      .text("Number of Unemployed: " + numberWithCommas(d['unemp'+year.toString()]));
                    
                    d3.select("#rate")
                      .text("Unemployment Rate: " + Math.round(d['unemprate'+year.toString()] * 1000)/10 + "%");
                    
                    //Show the tooltip
                    d3.select("#tooltip").classed("hidden", false);
                })
                .on("mouseout", function() {
                    svg.selectAll("circle").style("opacity",".75");
                    //Hide the tooltip
                    d3.select("#tooltip").classed("hidden", true);
                });
                
                
        });
    
    
        //Load in County CSV with Point Data
         d3.select("#yearRange")
            .on("change",function(){
                
                year = document.getElementById("yearRange").value;
                document.getElementById("range").innerHTML=year;
        
       
            

            //Draw circles for each point
            svg.selectAll("circle")
                .data(dataset)
                .transition()
                .duration(1000)
                .attr("cx", function(d) {
                    return projection([d.lon, d.lat])[0];
                })
                .attr("cy", function(d) {
                    return projection([d.lon, d.lat])[1];
                })
                //Set the Radius
                .attr("r", function(d){
                    return Math.sqrt(parseInt(d['unemp'+year.toString()]) * 0.5);    
                })
                //Set the Fill Color
                .style("fill", function(d) {
                    var value = d['unemprate'+year.toString()];			   		
                    if(value) {
                        return color(value);
                    }
                    else {
			//If value is undefined…
			return "#333";
		    }
		})
                .style("opacity",".75")
                .on("mouseover", function(d) {
                    //Get this bar's x/y values, then augment for the tooltip
                    var xPosition = parseFloat(d3.select(this).attr("cx")) +30;
                    var yPosition = parseFloat(d3.select(this).attr("cy")) -15;
                    console.log(xPosition, yPosition);
                    
                    //Update the tooltip position and value
                    d3.select("#tooltip")
                      .style("left", xPosition + "px")
                      .style("top", yPosition  + "px")
                      .select("#name")
                      .text(d.name + " County");
                      
                    d3.select("#unemployed")
                      .text("Number of Unemployed: " + numberWithCommas(d['unemp'+year.toString()]));
                    
                    d3.select("#rate")
                      .text("Unemployment Rate: " + Math.round(d['unemprate'+year.toString()] * 1000)/10 + "%");
                    
                    //Show the tooltip
                    d3.select("#tooltip").classed("hidden", false);
                })
                .on("mouseout", function() {
                    svg.selectAll("circle").style("opacity",".75");
                    //Hide the tooltip
                    d3.select("#tooltip").classed("hidden", true);
                });
                
                
        });
        });    
   
    
    
    
    
  }
    
   
     
    
    function numberWithCommas(x) {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }
    
    
   
        
        
        
        
        
    
 
    </script>
    
    
        
        

        </div> <!-- /.content -->
    </div><!-- /.container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
   <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
  </body>
</html>